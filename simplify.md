‚óè –ê–Ω–∞–ª—ñ–∑ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –û—Å—å –¥–µ—Ç–∞–ª—å–Ω–∏–π –∑–≤—ñ—Ç –ø—Ä–æ –∑–Ω–∞–π–¥–µ–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏ —É —Ç–≤–æ—î–º—É –∫–æ–¥–±–µ–π—Å—ñ:

  ---
  üìä –ê–Ω–∞–ª—ñ–∑ –ö–æ–¥–±–µ–π–∑—É ChatIQ MVP

  üö® –ü–†–Ü–û–†–ò–¢–ï–¢ 1: –ö—Ä–∏—Ç–∏—á–Ω—ñ –ü—Ä–æ–±–ª–µ–º–∏ –ë–µ–∑–ø–µ–µ–∫–∏

  1.1 –í—ñ–¥—Å—É—Ç–Ω—è –ê–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è –Ω–∞ Chat Controller (–ö–†–ò–¢–ò–ß–ù–û!)

  –§–∞–π–ª: api-server/src/chat/chat.controller.ts

  @Controller('chats')
  // @UseGuards(AuthGuard('jwt'))  // <-- –ó–ê–ö–û–ú–ï–ù–¢–û–í–ê–ù–û!
  export class ChatController {

  –í–ø–ª–∏–≤: –í—Å—ñ –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ —á–∞—Ç—ñ–≤ –¥–æ—Å—Ç—É–ø–Ω—ñ –±–µ–∑ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó:
  - GET /chats/site/:siteId - –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –≤—Å—ñ—Ö —á–∞—Ç—ñ–≤
  - GET /chats/:chatId/history - —ñ—Å—Ç–æ—Ä—ñ—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
  - DELETE /chats/:chatId - –≤–∏–¥–∞–ª–µ–Ω–Ω—è —á–∞—Ç—ñ–≤
  - PATCH /chats/:chatId/rename - –ø–µ—Ä–µ–π–º–µ–Ω—É–≤–∞–Ω–Ω—è

  1.2 –í—ñ–¥—Å—É—Ç–Ω—è –ê–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è –Ω–∞ Automation & Widget Settings Controllers

  - automation.controller.ts - –Ω–µ–º–∞—î @UseGuards –≤–∑–∞–≥–∞–ª—ñ
  - widget-settings.controller.ts - –Ω–µ–º–∞—î @UseGuards

  1.3 –í—ñ–¥—Å—É—Ç–Ω—è Tenant Isolation (Cross-Site Data Leak!)

  –§–∞–π–ª: api-server/src/automation/automation.service.ts

  // ‚ùå –ü–û–ì–ê–ù–û - –¥–æ–∑–≤–æ–ª—è—î –¥–æ—Å—Ç—É–ø –¥–æ —á—É–∂–∏—Ö –¥–∞–Ω–∏—Ö
  async updateAutoReply(id: string, data: {...}) {
      return this.prisma.autoReply.update({
          where: { id },  // –ù–µ –ø–µ—Ä–µ–≤—ñ—Ä—è—î siteId!
          data,
      });
  }

  –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:
  // ‚úÖ –î–û–ë–†–ï
  async updateAutoReply(siteId: string, id: string, data: {...}) {
      const existing = await this.prisma.autoReply.findFirst({
          where: { id, siteId }
      });
      if (!existing) throw new NotFoundException();
      return this.prisma.autoReply.update({ where: { id }, data });
  }

  ---
  üìã –ü–†–Ü–û–†–ò–¢–ï–¢ 2: –ü–æ—Ä—É—à–µ–Ω–Ω—è –°—Ç–∞–Ω–¥–∞—Ä—Ç—ñ–≤

  2.1 –ú–∞—Å–æ–≤–µ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è console.log (41+ –≤—Ö–æ–¥–∂–µ–Ω—å)

  –ú–∞—î –±—É—Ç–∏: NestJS Logger

  –ó–Ω–∞–π–¥–µ–Ω–æ –≤:
  - automation.service.ts - 17 —Ä–∞–∑—ñ–≤
  - chat.gateway.ts - 15 —Ä–∞–∑—ñ–≤
  - chat.controller.ts - 4 —Ä–∞–∑–∏
  - auth.service.ts - 2 —Ä–∞–∑–∏
  - google.strategy.ts - 4 —Ä–∞–∑–∏

  2.2 Generic Error –∑–∞–º—ñ—Å—Ç—å NestJS Exceptions

  // ‚ùå –ü–æ–≥–∞–Ω–æ
  throw new Error('Organization not found');

  // ‚úÖ –î–æ–±—Ä–µ
  throw new NotFoundException('Organization not found');

  –§–∞–π–ª–∏: organization.controller.ts, sites.service.ts, chat.service.ts

  2.3 –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è any —Ç–∏–ø—É (7+ –≤—Ö–æ–¥–∂–µ–Ω—å)

  –§–∞–π–ª–∏:
  - auth.controller.ts (lines 30, 32, 42)
  - automation.service.ts (line 415)
  - admin-panel/app/chats/page.tsx (multiple)

  2.4 –í—ñ–¥—Å—É—Ç–Ω—ñ DTOs –¥–ª—è –í–∞–ª—ñ–¥–∞—Ü—ñ—ó

  –ü—Ä–æ–±–ª–µ–º–∞: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è —ñ–Ω–ª–∞–π–Ω —Ç–∏–ø–∏ –∑–∞–º—ñ—Å—Ç—å class-validator DTOs

  –§–∞–π–ª–∏: automation.controller.ts, chat.controller.ts, auth.controller.ts

  –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:
  // –°—Ç–≤–æ—Ä–∏—Ç–∏ DTO –∫–ª–∞—Å–∏
  export class CreateAutoReplyDto {
      @IsString()
      @MinLength(1)
      name: string;

      @IsEnum(AutoReplyTrigger)
      trigger: string;
  }

  ---
  üîß –ü–†–Ü–û–†–ò–¢–ï–¢ 3: –°—Ç–∏–ª—å —ñ Best Practices

  3.1 Hardcoded URLs

  –§–∞–π–ª: upload.controller.ts:38
  const fileUrl = `http://localhost:3000/uploads/${file.filename}`;

  –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è: –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ env –∑–º—ñ–Ω–Ω—É

  3.2 –î—É–±–ª—é–≤–∞–Ω–Ω—è –ö–æ–¥—É (API URL Configuration)

  –§–∞–π–ª–∏: admin-panel/app/chats/page.tsx, admin-panel/components/chat-view.tsx

  –û–¥–Ω–∞–∫–æ–≤–∏–π –∫–æ–¥ –ø–æ–≤—Ç–æ—Ä—é—î—Ç—å—Å—è 3 —Ä–∞–∑–∏:
  const apiUrl = (typeof window !== 'undefined' && localStorage.getItem('chtq_api_url'))
      || process.env.NEXT_PUBLIC_API_URL
      || "http://localhost:3000";

  –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è: –í–∏–Ω–µ—Å—Ç–∏ –≤ lib/api-config.ts

  3.3 ESLint –ü—Ä–∞–≤–∏–ª–∞ –í–∏–º–∫–Ω–µ–Ω—ñ –ó–∞–º—ñ—Å—Ç—å –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

  –§–∞–π–ª: auth.controller.ts
  // eslint-disable-next-line @typescript-eslint/no-unsafe-argument
  const { access_token } = await this.authService.login(req.user as any);

  ---
  üìä –ó–∞–≥–∞–ª—å–Ω–∞ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
  ‚îÇ –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç ‚îÇ          –ö–∞—Ç–µ–≥–æ—Ä—ñ—è           ‚îÇ –ö—ñ–ª—å–∫—ñ—Å—Ç—å ‚îÇ       –§–∞–π–ª—ñ–≤       ‚îÇ
  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
  ‚îÇ P1        ‚îÇ –í—ñ–¥—Å—É—Ç–Ω—è –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è      ‚îÇ 3         ‚îÇ controllers        ‚îÇ
  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
  ‚îÇ P1        ‚îÇ –í—ñ–¥—Å—É—Ç–Ω—è tenant isolation    ‚îÇ 4         ‚îÇ automation.service ‚îÇ
  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
  ‚îÇ P2        ‚îÇ console.log –∑–∞–º—ñ—Å—Ç—å Logger   ‚îÇ 41+       ‚îÇ 6 —Ñ–∞–π–ª—ñ–≤           ‚îÇ
  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
  ‚îÇ P2        ‚îÇ Generic Error –∑–∞–º—ñ—Å—Ç—å NestJS ‚îÇ 4         ‚îÇ 3 —Ñ–∞–π–ª–∏            ‚îÇ
  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
  ‚îÇ P2        ‚îÇ any —Ç–∏–ø                      ‚îÇ 7+        ‚îÇ 4 —Ñ–∞–π–ª–∏            ‚îÇ
  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
  ‚îÇ P2        ‚îÇ –í—ñ–¥—Å—É—Ç–Ω—ñ DTOs                ‚îÇ 3         ‚îÇ controllers        ‚îÇ
  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
  ‚îÇ P3        ‚îÇ Hardcoded URLs               ‚îÇ 1         ‚îÇ upload.controller  ‚îÇ
  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
  ‚îÇ P3        ‚îÇ –î—É–±–ª—é–≤–∞–Ω–Ω—è –∫–æ–¥—É              ‚îÇ 3         ‚îÇ admin-panel        ‚îÇ
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
  ---
  üéØ –ü–ª–∞–Ω –î—ñ–π

  –ù–µ–≥–∞–π–Ω–æ (–ë–µ–∑–ø–µ–∫–∞):

  1. ‚úÖ –†–æ–∑–∫–æ–º–µ–Ω—Ç—É–≤–∞—Ç–∏ @UseGuards –Ω–∞ ChatController
  2. ‚úÖ –î–æ–¥–∞—Ç–∏ @UseGuards –Ω–∞ AutomationController
  3. ‚úÖ –î–æ–¥–∞—Ç–∏ @UseGuards –Ω–∞ WidgetSettingsController
  4. ‚úÖ –î–æ–¥–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É siteId –≤ update/delete –æ–ø–µ—Ä–∞—Ü—ñ—è—Ö

  –ö–æ—Ä–æ—Ç–∫–æ—Å—Ç—Ä–æ–∫–æ–≤–æ (–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏):

  5. –ó–∞–º—ñ–Ω–∏—Ç–∏ –≤—Å—ñ console.log –Ω–∞ NestJS Logger
  6. –ó–∞–º—ñ–Ω–∏—Ç–∏ Error –Ω–∞ NestJS exceptions
  7. –°—Ç–≤–æ—Ä–∏—Ç–∏ DTOs –∑ class-validator

  –°–µ—Ä–µ–¥–Ω—å–æ—Å—Ç—Ä–æ–∫–æ–≤–æ (–Ø–∫—ñ—Å—Ç—å):

  8. –í–∏–ø—Ä–∞–≤–∏—Ç–∏ –≤—Å—ñ any —Ç–∏–ø–∏
  9. –í–∏–Ω–µ—Å—Ç–∏ shared utilities (API config)
  10. –í–∏–¥–∞–ª–∏—Ç–∏ debug logging
  11. –í–∏–ø—Ä–∞–≤–∏—Ç–∏ ESLint –ø–æ—Ä—É—à–µ–Ω–Ω—è