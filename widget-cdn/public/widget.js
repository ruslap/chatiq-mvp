!function(){"use strict";const n="3.2.1",e=window.chtq||{},a=window.ChatIQConfig||{},t=document.currentScript,i=e.apiUrl||"https://api.chtq.ink",r={organizationId:e.organizationId||a.siteId||t?.getAttribute("data-site-id")||null,language:e.language||a.language||"uk",color:e.color||a.accentColor||"#6366F1",position:e.position||a.position||"right",size:e.size||a.size||"standard",theme:e.theme||a.theme||"light",agentName:e.agentName||a.agentName||"Support Team",agentAvatar:e.agentAvatar||a.agentAvatar||null,welcomeMessage:e.welcomeMessage||a.welcomeMessage||null},o=["image/*","application/pdf",".doc",".docx",".txt"],s={uk:{online:"–û–Ω–ª–∞–π–Ω",offline:"–ù–µ –≤ –º–µ—Ä–µ–∂—ñ",offlineHint:"–ú–∏ –≤—ñ–¥–ø–æ–≤—ñ–º–æ —É —Ä–æ–±–æ—á–∏–π —á–∞—Å",offlineBanner:"–ú–∏ —Ç–∏–º—á–∞—Å–æ–≤–æ –æ—Ñ–ª–∞–π–Ω. –ó–∞–ª–∏—à—Ç–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —ñ –º–∏ –ø–æ–≤–µ—Ä–Ω–µ–º–æ—Å—å!",welcomeFallback:"–î—è–∫—É—î–º–æ –∑–∞ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è! –ú–∏ —Å–∫–æ—Ä–æ –≤—ñ–¥–ø–æ–≤—ñ–º–æ.",contactFormTitle:"–ó–∞–ª–∏—à—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç–∏",contactFormDesc:"–ú–∏ –∑–∞—Ä–∞–∑ –æ—Ñ–ª–∞–π–Ω. –ó–∞–ª–∏—à—Ç–µ —Å–≤–æ—ó –¥–∞–Ω—ñ —ñ –º–∏ –∑–≤ º—è–∂–µ–º–æ—Å—è –∑ –≤–∞–º–∏.",contactName:"–Ü–º º—è",contactEmail:"Email",contactPhone:"–¢–µ–ª–µ—Ñ–æ–Ω",contactMessage:"–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)",contactSubmit:"–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏",contactSuccess:"–î—è–∫—É—î–º–æ! –ú–∏ –∑–≤ º—è–∂–µ–º–æ—Å—è –∑ –≤–∞–º–∏ –Ω–∞–π–±–ª–∏–∂—á–∏–º —á–∞—Å–æ–º."},en:{online:"Online",offline:"Offline",offlineHint:"We will reply during business hours",offlineBanner:"We are currently offline. Leave a message and we will get back to you!",welcomeFallback:"Thanks for reaching out! We will respond shortly.",contactFormTitle:"Leave your contacts",contactFormDesc:"We are currently offline. Leave your details and we will contact you.",contactName:"Name",contactEmail:"Email",contactPhone:"Phone",contactMessage:"Message (optional)",contactSubmit:"Submit",contactSuccess:"Thank you! We will contact you soon."}};function c(n){return(s[r.language]||s.en)[n]||s.en[n]||n}function l(n){const e=document.createElement("div");return e.textContent=n,e.innerHTML}function d(n){if(0===n)return"0 B";const e=Math.floor(Math.log(n)/Math.log(1024));return parseFloat((n/Math.pow(1024,e)).toFixed(1))+" "+["B","KB","MB","GB"][e]}let p="false"!==localStorage.getItem("chatiq_sound_enabled");function m(n,e,a="sine"){if(p)try{const t=new(window.AudioContext||window.webkitAudioContext);(Array.isArray(n)?n:[n]).forEach((n,i)=>{const r=t.createOscillator(),o=t.createGain();r.connect(o),o.connect(t.destination),r.frequency.value=n,r.type=a,o.gain.setValueAtTime(.1,t.currentTime),o.gain.exponentialRampToValueAtTime(.01,t.currentTime+e),r.start(t.currentTime+.1*i),r.stop(t.currentTime+e+.1*i)})}catch(t){console.warn("[ChatIQ] Sound playback failed:",t)}}const g=()=>m(800,.1,"sine"),v=()=>m(600,.15,"sine"),u=()=>m([600,800],.1,"sine"),f=()=>m(400,.05,"sine"),h=()=>m(300,.1,"sine");async function b(n){try{const e=await fetch(`${i}/automation/business-hours/${n}/status`);if(e.ok)return await e.json()}catch(e){console.warn("[Chtq] Failed to fetch business hours status:",e)}return{isOpen:!0}}let x=null;function y(n,e,a){window.io?(x=window.io(i,{query:{siteId:n,visitorId:e}}),x.on("connect",()=>{console.log("[Chtq] Connected to server"),x.emit("visitor:join",{siteId:n,visitorId:e})}),x.on("admin:message",n=>{const e=n;a.onAdminMessage(e)}),x.on("message:edited",n=>{a.onMessageEdited(n)}),x.on("message:deleted",n=>{a.onMessageDeleted(n)})):console.warn("[Chtq] Socket.IO not loaded")}function w(n,e){const a=n.getElementById("badge"),t=n.getElementById("launcher");a&&t&&(e>0?(a.textContent=e>99?"99+":String(e),a.classList.add("visible"),t.classList.add("pulse")):(a.classList.remove("visible"),t.classList.remove("pulse")))}function k(n,e){const a=n.getElementById("messages");if(!a)return;const{text:t,from:i,attachment:r,messageId:o,agentAvatar:s}=e,c="bot"===i,p=(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});const m=document.createElement("div");m.className=`message ${i}`,o&&m.setAttribute("data-message-id",o);let g="";c&&(g=s?`<img src="${s}" alt="Agent" class="message-avatar" />`:'\n        <div class="message-avatar">\n          <svg viewBox="0 0 24 24" aria-hidden="true">\n            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>\n          </svg>\n        </div>');let v='<div class="message-bubble">';v+=l(t),r&&("string"==typeof r?r.match(/\.(jpg|jpeg|png|gif|webp)$/i)?v+=`\n                <div class="message-attachment">\n                    <a href="${r}" target="_blank" rel="noopener">\n                        <img src="${r}" class="attachment-image" alt="Attachment" loading="lazy" />\n                    </a>\n                </div>`:v+=`\n                <div class="message-attachment">\n                    <a href="${r}" target="_blank" rel="noopener" class="attachment-link">\n                        Download File\n                    </a>\n                </div>`:r.type.startsWith("image/")?v+=`\n                <div class="message-attachment">\n                    <a href="${r.url}" target="_blank" rel="noopener">\n                        <img src="${r.url}" class="attachment-image" alt="${l(r.name)}" loading="lazy" />\n                    </a>\n                </div>`:v+=`\n                <div class="message-attachment">\n                    <a href="${r.url}" target="_blank" rel="noopener" style="display: flex; align-items: center; gap: 8px; text-decoration: none; color: inherit; padding: 8px;">\n                        <div class="attachment-icon">\n                            <svg style="width: 24px; height: 24px;" viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6H6zm7 7V3.5L18.5 9H13z"/></svg>\n                        </div>\n                        <div class="attachment-info">\n                            <div class="attachment-name">${l(r.name)}</div>\n                            <div class="attachment-size">${d(r.size)}</div>\n                        </div>\n                    </a>\n                </div>`),v+="</div>";const u=`\n    <div class="message-meta">\n      <span class="message-time">${p}</span>\n      ${c?"":'<span class="message-status"><svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></span>'}\n    </div>\n  `;m.innerHTML=g+`\n    <div class="message-content">\n      ${v}\n      ${u}\n    </div>\n  `,a.appendChild(m),z(a)}function z(n){n.scrollTop=n.scrollHeight}const C=["üòÄ","üòÉ","üòÑ","üòÅ","üòÖ","üòÇ","ü§£","üòä","üòá","üôÇ","üôÉ","üòâ","üòå","üòç","ü•∞","üòò","üòó","üòô","üòö","üòã","üòõ","üòù","üòú","ü§™","ü§®","üßê","ü§ì","üòé","ü§©","ü•≥","üòè","üòí","üòû","üòî","üòü","üòï","üôÅ","üò£","üòñ","üò´","üò©","ü•∫","üò¢","üò≠","üò§","üò†","üò°","ü§¨","ü§Ø","üò≥","ü•µ","ü•∂","üò±","üò®","üò∞","üò•","üòì","ü§ó","ü§î","ü§≠","ü§´","ü§•","üò∂","üòê","üòë","üò¨","üôÑ","üòØ","üò¶","üòß","üòÆ","üò≤","ü•±","üò¥","ü§§","üò™","üòµ","ü§ê","ü•¥","ü§¢","ü§Æ","ü§ß","üò∑","ü§í","ü§ï","ü§ë","ü§†","üëç","üëé","üëå","‚úåÔ∏è","ü§û","ü§ü","ü§ò","ü§ô","üëà","üëâ","üëÜ","üëá","‚òùÔ∏è","‚úã","ü§ö","üñê","üññ","üëã","ü§ù","üí™","ü¶æ","üôè","‚úçÔ∏è","üíÖ","ü§≥","üíÉ","üï∫","üëØ","üßò","üõÄ","üõå","üë•","üó£","üë§","üî•","‚≠ê","‚ú®","üí´","üí•","üíØ","üí¢","üí¨","üëÅ","üß†","ü´Ä","ü´Å","ü¶∑","ü¶¥","üëÄ","üëÅÔ∏è","üëÉ","üëÇ","ü¶ª","üßè","üíò","üíù","üíñ","üíó","üíì","üíû","üíï","üíü","‚ù£Ô∏è","üíî","‚ù§Ô∏è","üß°","üíõ","üíö","üíô","üíú","ü§é","üñ§","ü§ç","üéâ","üéä","üéà","üéÅ","üèÜ","ü•á","ü•à","ü•â","‚öΩ","üèÄ","üèà","‚öæ","ü•é","üéæ","üèê","üèâ","ü•è","üé±","ü™Ä","üèì","üè∏","üèí","üèë","ü•ç","üèè","ü™É","ü•Ö","‚õ≥","ü™Å","üèπ","üé£","ü§ø","ü•ä","ü•ã","üéΩ","üõπ","üõº","üõ∑","‚õ∏","ü•å","üéø","‚õ∑","üèÇ"];function F(n,e){const a=e?C.filter(n=>n.includes(e)):C;n.innerHTML=a.map(n=>`<button class="emoji-btn" data-emoji="${n}">${n}</button>`).join("")}!function(){const e=r.organizationId;if(!e)return void console.warn("[Chtq] Missing organizationId. Please configure window.chtq or use data-site-id attribute.");let a=null,t=r.color,s=r.secondaryColor||t,m=r.agentName,C=r.agentAvatar,E=r.welcomeMessage||c("welcomeFallback"),M={isOpen:!0},L=!1,I=0;const B=function(){const n="chtq_visitor_id";let e=localStorage.getItem(n);return e||(e="v_"+Math.random().toString(36).substring(2,15)+Date.now().toString(36),localStorage.setItem(n,e)),e}();let $=null,j=null;async function S(){if(a=await async function(n){try{const e=await fetch(`${i}/organization/resolve/${n}`);return e.ok?(await e.json()).siteId||null:(console.warn("[Chtq] Failed to resolve siteId"),null)}catch(e){return console.warn("[Chtq] Error resolving siteId:",e),null}}(e),!a)return void console.warn("[Chtq] Could not resolve siteId, widget disabled");const n=await async function(n){try{const e=await fetch(`${i}/widget-settings/${n}`);return e.ok?await e.json():null}catch(e){return console.warn("[Chtq] Failed to fetch settings:",e),null}}(e);n&&function(n){n.operatorName&&(m=n.operatorName);n.operatorAvatar&&(C=n.operatorAvatar);n.welcomeMessage&&(E=n.welcomeMessage);void 0!==n.showContactForm&&n.showContactForm;n.color&&(t=n.color,localStorage.setItem(`chtq_color_${e}`,n.color));s=n.secondaryColor?n.secondaryColor:t}(n),M=await b(a),function(){j=document.createElement("div"),j.id="chatiq-widget",Object.assign(j.style,{position:"fixed",bottom:"0",right:"0",width:"auto",height:"auto",zIndex:"2147483647",overflow:"visible",pointerEvents:"none"}),document.body.appendChild(j),$=j.attachShadow({mode:"open"});const n=function(n){const e=parseInt(n.slice(1,3),16)/255,a=parseInt(n.slice(3,5),16)/255,t=parseInt(n.slice(5,7),16)/255,i=Math.max(e,a,t),r=Math.min(e,a,t);let o=0,s=0;const c=(i+r)/2;if(i!==r){const n=i-r;switch(s=c>.5?n/(2-i-r):n/(i+r),i){case e:o=((a-t)/n+(a<t?6:0))/6;break;case a:o=((t-e)/n+2)/6;break;case t:o=((e-a)/n+4)/6}}return{h:Math.round(360*o),s:Math.round(100*s),l:Math.round(100*c)}}(t),l=function(n,e,a,t,i,r){return`<style>${n}</style>\n    \n    \x3c!-- Launcher --\x3e\n    <button class="launcher position-${r}" id="launcher" aria-label="Open chat">\n      <svg class="icon-chat" viewBox="0 0 400 400" aria-hidden="true">\n        <path d="M322.251 235.8C319.251 235.8 316.784 234.933 314.851 233.2C312.984 231.4 312.051 229.2 312.051 226.6C312.051 223.933 312.984 221.7 314.851 219.9C316.784 218.1 319.251 217.2 322.251 217.2C325.184 217.2 327.584 218.1 329.451 219.9C331.384 221.7 332.351 223.933 332.351 226.6C332.351 229.2 331.384 231.4 329.451 233.2C327.584 234.933 325.184 235.8 322.251 235.8Z" />\n        <path d="M244.98 207.2C244.98 201.667 246.113 196.733 248.38 192.4C250.713 188.067 253.813 184.7 257.68 182.3C261.613 179.833 265.88 178.6 270.48 178.6C274.013 178.6 277.18 179.233 279.98 180.5C282.78 181.7 285.046 183.4 286.78 185.6V179.2H303.88V261.6H286.78V228C284.846 230.333 282.48 232.2 279.68 233.6C276.946 235 273.813 235.7 270.28 235.7C265.746 235.7 261.546 234.5 257.68 232.1C253.813 229.7 250.713 226.333 248.38 222C246.113 217.667 244.98 212.733 244.98 207.2ZM286.78 207.1C286.78 204.1 286.18 201.6 284.98 199.6C283.846 197.533 282.346 196 280.48 195C278.613 193.933 276.646 193.4 274.58 193.4C272.58 193.4 270.646 193.933 268.78 195C266.913 196 265.38 197.533 264.18 199.6C262.98 201.667 262.38 204.2 262.38 207.2C262.38 210.2 262.98 212.733 264.18 214.8C265.38 216.8 266.913 218.333 268.78 219.4C270.646 220.4 272.58 220.9 274.58 220.9C276.58 220.9 278.513 220.4 280.38 219.4C282.313 218.333 283.846 216.767 284.98 214.7C286.18 212.633 286.78 210.1 286.78 207.1Z" />\n        <path d="M240.855 220.5V235H232.155C225.955 235 221.121 233.5 217.655 230.5C214.188 227.433 212.455 222.467 212.455 215.6V193.4H205.655V179.2H212.455V165.6H229.555V179.2H240.755V193.4H229.555V215.8C229.555 217.467 229.955 218.667 230.755 219.4C231.555 220.133 232.888 220.5 234.755 220.5H240.855Z" />\n        <path d="M178.672 178.6C185.072 178.6 190.205 180.733 194.072 185C197.938 189.2 199.872 195 199.872 202.4V235H182.872V204.7C182.872 200.967 181.905 198.067 179.972 196C178.038 193.933 175.438 192.9 172.172 192.9C168.905 192.9 166.305 193.933 164.372 196C162.438 198.067 161.472 200.967 161.472 204.7V235H144.372V161H161.472V186.7C163.205 184.233 165.572 182.267 168.572 180.8C171.572 179.333 174.938 178.6 178.672 178.6Z" />\n        <path d="M67.3 199.8C67.3 192.867 68.8 186.7 71.8 181.3C74.8 175.833 78.9667 171.6 84.3001 168.6C89.7001 165.533 95.8001 164 102.6 164C110.933 164 118.067 166.2 124 170.6C129.933 175 133.9 181 135.9 188.6H117.1C115.7 185.667 113.7 183.433 111.1 181.9C108.567 180.367 105.667 179.6 102.4 179.6C97.1334 179.6 92.8667 181.433 89.6 185.1C86.3334 188.767 84.7001 193.667 84.7001 199.8C84.7001 205.933 86.3334 210.833 89.6 214.5C92.8667 218.167 97.1334 220 102.4 220C105.667 220 108.567 219.233 111.1 217.7C113.7 216.167 115.7 213.933 117.1 211H135.9C133.9 218.6 129.933 224.6 124 229C118.067 233.333 110.933 235.5 102.6 235.5C95.8001 235.5 89.7001 234 84.3001 231C78.9667 227.933 74.8 223.7 71.8 218.3C68.8 212.9 67.3 206.733 67.3 199.8Z" />\n      </svg>\n      <svg class="icon-close" viewBox="0 0 24 24" aria-hidden="true">\n        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>\n      </svg>\n      <span class="launcher-badge" id="badge"></span>\n    </button>\n    \n    \x3c!-- Panel --\x3e\n    <div class="panel position-${r}" id="panel" role="dialog" aria-modal="true" aria-labelledby="chat-title">\n      \x3c!-- Drag & Drop Overlay --\x3e\n      <div class="drop-overlay" id="drop-overlay">\n        <div class="drop-content">\n          <div class="drop-icon">\n            <svg viewBox="0 0 24 24">\n              <path d="M19.35 10.04C18.67 6.59 15.64 4 12 4c-1.48 0-2.85.43-4.01 1.17l1.46 1.46C10.21 6.23 11.08 6 12 6c3.04 0 5.5 2.46 5.5 5.5v.5H19c1.66 0 3 1.34 3 3 0 1.13-.64 2.11-1.56 2.62l1.45 1.45C23.16 18.16 24 16.68 24 15c0-2.64-2.05-4.78-4.65-4.96zM3 5.27l2.75 2.74C2.56 8.15 0 10.77 0 14c0 3.31 2.69 6 6 6h11.73l2 2L21 20.73 4.27 4 3 5.27zM7.73 10l8 8H6c-2.21 0-4-1.79-4-4s1.79-4 4-4h1.73z"/>\n            </svg>\n          </div>\n          <div class="drop-text">Drop files to upload</div>\n        </div>\n      </div>\n\n      \x3c!-- Header --\x3e\n      <div class="header">\n        <div class="header-avatar" id="header-avatar">\n          <svg viewBox="0 0 24 24" aria-hidden="true" class="avatar-icon-online">\n            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>\n          </svg>\n          <svg viewBox="0 0 24 24" aria-hidden="true" class="avatar-icon-offline" style="display: none;">\n            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8 0-1.85.63-3.55 1.69-4.9l10.21 10.21C14.55 19.37 13.35 20 12 20zm6.31-3.1L7.1 5.69C8.45 4.63 10.15 4 12 4c4.41 0 8 3.59 8 8 0 1.85-.63 3.55-1.69 4.9z"/>\n          </svg>\n        </div>\n        <div class="header-content">\n          <div class="header-title" id="chat-title">${e}</div>\n            <div class="header-status">\n              <span class="status-text">–û–Ω–ª–∞–π–Ω</span>\n            </div>\n        </div>\n        <div class="header-actions">\n          <button class="header-btn" id="sound-btn" aria-label="Toggle sound">\n            <svg class="sound-on-icon" viewBox="0 0 24 24" style="display: ${i?"block":"none"}">\n              <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>\n            </svg>\n            <svg class="sound-off-icon" viewBox="0 0 24 24" style="display: ${i?"none":"block"}">\n              <path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>\n            </svg>\n          </button>\n          <button class="header-btn" id="close-btn" aria-label="Close chat">\n            <svg viewBox="0 0 24 24" aria-hidden="true">\n              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>\n            </svg>\n          </button>\n        </div>\n      </div>\n      \n      \x3c!-- Messages --\x3e\n      <div class="messages" id="messages" role="log" aria-live="polite">\n        <div class="welcome" id="welcome">\n          <div class="welcome-card">\n            <div class="welcome-icon">\n              <svg viewBox="0 0 24 24" aria-hidden="true">\n                <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/>\n              </svg>\n            </div>\n            <div class="welcome-title">–ü—Ä–∏–≤—ñ—Ç! üëã</div>\n            <div class="welcome-text welcome-msg">${t}</div>\n            <div class="welcome-name-form">\n              <label class="welcome-name-label">–Ø–∫ –¥–æ –≤–∞—Å –∑–≤–µ—Ä—Ç–∞—Ç–∏—Å—è?</label>\n              <input type="text" id="visitor-name-input" class="welcome-name-input" placeholder="–í–∞—à–µ —ñ–º'—è" autocomplete="name" />\n            </div>\n            <div class="welcome-action">\n              <button class="btn-start" id="start-btn">\n                –ü–æ—á–∞—Ç–∏ —Ä–æ–∑–º–æ–≤—É\n                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">\n                  <path d="M5 12h14M12 5l7 7-7 7"/>\n                </svg>\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n      \n      \x3c!-- Composer --\x3e\n      <div class="composer-container" style="display: none;" id="composer-container">\n        <div class="composer">\n          <div class="upload-preview" id="upload-preview">\n            <div class="upload-preview-thumb" id="upload-thumb"></div>\n            <div class="upload-preview-info">\n              <div class="upload-preview-name" id="upload-name"></div>\n              <div class="upload-preview-size" id="upload-size"></div>\n            </div>\n            <button class="upload-preview-remove" id="upload-remove" aria-label="Remove file">\n              <svg viewBox="0 0 24 24">\n                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>\n              </svg>\n            </button>\n          </div>\n\n          <div class="composer-main">\n            <div class="composer-actions">\n              <button class="composer-action-btn" id="attach-btn" aria-label="Attach file">\n                <svg viewBox="0 0 24 24">\n                  <path d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"/>\n                </svg>\n              </button>\n              <button class="composer-action-btn" id="emoji-btn" aria-label="Insert emoji">\n                <svg viewBox="0 0 24 24">\n                  <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z"/>\n                </svg>\n              </button>\n            </div>\n\n            <div class="composer-input-wrapper">\n              <textarea \n                class="composer-input" \n                id="input" \n                placeholder="Type a message..." \n                rows="1"\n                aria-label="Type your message"\n              ></textarea>\n              \n              \x3c!-- Emoji Picker --\x3e\n              <div class="emoji-picker" id="emoji-picker">\n                <div class="emoji-picker-header">\n                  <input type="text" class="emoji-picker-search" id="emoji-search" placeholder="Search emoji...">\n                </div>\n                <div class="emoji-picker-content">\n                  <div class="emoji-grid" id="emoji-grid"></div>\n                </div>\n              </div>\n            </div>\n\n            <button class="composer-send" id="send-btn" disabled aria-label="Send message">\n              <svg viewBox="0 0 24 24" aria-hidden="true">\n                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>\n              </svg>\n            </button>\n          </div>\n        </div>\n      </div>\n\n\n      \x3c!-- Contact Form (shown when offline) --\x3e\n      <div class="contact-form-container" style="display: none;" id="contact-form-container">\n        <div class="contact-form">\n          <div class="contact-form-header">\n            <h3 class="contact-form-title">${c("contactFormTitle")}</h3>\n            <p class="contact-form-desc">${c("contactFormDesc")}</p>\n          </div>\n          <form id="contact-form" class="contact-form-fields">\n            <div class="contact-form-field">\n              <input type="text" id="contact-name" class="contact-input" placeholder="${c("contactName")}" required />\n            </div>\n            <div class="contact-form-field">\n              <input type="email" id="contact-email" class="contact-input" placeholder="${c("contactEmail")}" />\n            </div>\n            <div class="contact-form-field">\n              <input type="tel" id="contact-phone" class="contact-input" placeholder="${c("contactPhone")}" />\n            </div>\n            <div class="contact-form-field">\n              <textarea id="contact-message" class="contact-textarea" placeholder="${c("contactMessage")}" rows="3"></textarea>\n            </div>\n            <button type="submit" class="contact-submit" id="contact-submit">\n              ${c("contactSubmit")}\n            </button>\n          </form>\n          <div class="contact-success" id="contact-success" style="display: none;">\n            <svg viewBox="0 0 24 24" style="width: 48px; height: 48px; fill: var(--success-color, #10B981); margin-bottom: 12px;">\n              <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>\n            </svg>\n            <p>${c("contactSuccess")}</p>\n            </div>\n      </div>\n      </div>\n\n      \x3c!-- Powered by --\x3e\n      <div class="powered">\n        Powered by <a href="https://ruslan-lapiniak-cv.vercel.app/en" target="_blank" rel="noopener">Chatq ¬© Ruslan Lap</a>\n      </div>\n\n\n      \x3c!-- Hidden file input --\x3e\n      <input type="file" id="file-input" accept="${o.join(",")}" style="display: none !important; visibility: hidden !important; position: absolute; left: -9999px;" />\n    </div>\n    `}(function(n,e,a,t){return`\n    /* ===== FONTS ===== */\n    @import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');\n\n    /* ===== DESIGN TOKENS ===== */\n    :host {\n      /* Accent Color */\n      --accent-h: ${a.h};\n      --accent-s: ${a.s}%;\n      --accent-l: ${a.l}%;\n      \n      --accent: hsl(var(--accent-h), var(--accent-s), var(--accent-l));\n      --accent-hover: hsl(var(--accent-h), var(--accent-s), calc(var(--accent-l) - 8%));\n      --accent-light: hsl(var(--accent-h), var(--accent-s), 96%);\n      --accent-soft: hsl(var(--accent-h), calc(var(--accent-s) * 0.3), 95%);\n      --accent-text: ${a.l>60?"#000000":"#FFFFFF"};\n\n      /* Typography - Using DM Sans instead of generic system fonts */\n      --font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;\n      --font-mono: 'JetBrains Mono', 'Courier New', monospace;\n      --font-size-xs: 11px;\n      --font-size-sm: 12px;\n      --font-size-base: 14px;\n      --font-size-lg: 15px;\n      --font-weight-normal: 400;\n      --font-weight-medium: 500;\n      --font-weight-semibold: 600;\n      --font-weight-bold: 700;\n      --line-height: 1.5;\n\n      /* Spacing */\n      --space-1: 4px;\n      --space-2: 8px;\n      --space-3: 12px;\n      --space-4: 16px;\n      --space-5: 20px;\n      --space-6: 24px;\n      --space-8: 32px;\n\n      /* Border Radius */\n      --radius-sm: 6px;\n      --radius-md: 10px;\n      --radius-lg: 14px;\n      --radius-xl: 18px;\n      --radius-full: 9999px;\n\n      /* Transitions */\n      --ease-out: cubic-bezier(0.16, 1, 0.3, 1);\n      --ease-in-out: cubic-bezier(0.65, 0, 0.35, 1);\n      --ease-bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);\n      --duration-fast: 150ms;\n      --duration-base: 200ms;\n      --duration-slow: 300ms;\n\n      /* Z-index */\n      --z-launcher: 999999;\n      --z-panel: 999998;\n      --z-overlay: 999997;\n    }\n\n    /* ===== LIGHT THEME ===== */\n    :host {\n      --bg-primary: #FFFFFF;\n      --bg-secondary: #F8F9FA;\n      --bg-tertiary: #F1F3F5;\n      --bg-hover: #E9ECEF;\n      --bg-overlay: rgba(29, 35, 49, 0.4);\n      \n      --border-light: #F1F3F5;\n      --border-medium: #E9ECEF;\n      --border-strong: #DEE2E6;\n      \n      --text-primary: #1D2331;\n      --text-secondary: #495057;\n      --text-tertiary: #6C757D;\n      --text-muted: #ADB5BD;\n      \n      /* Primary Accent (Purple) */\n      --accent-primary: ${n};\n      /* Highlight Accent (Lime) - Used minimally */\n      --accent-highlight: ${e};\n      --accent-highlight-soft: ${e};\n      \n      --shadow-sm: 0 2px 8px rgba(29, 35, 49, 0.05);\n      --shadow-md: 0 4px 16px rgba(29, 35, 49, 0.08);\n      --shadow-lg: 0 12px 32px rgba(29, 35, 49, 0.12);\n      \n      --message-user-bg: var(--accent-primary);\n      --message-user-text: #FFFFFF;\n      --message-bot-bg: var(--bg-tertiary);\n      --message-bot-text: var(--text-primary);\n\n      --bg-pattern: none;\n    }\n\n    /* ===== DARK THEME ===== */\n    :host(.dark) {\n      --bg-primary: #1A1E28;\n      --bg-secondary: #242834;\n      --bg-tertiary: #2D3241;\n      --bg-hover: #363C4D;\n      --bg-overlay: rgba(0, 0, 0, 0.7);\n      \n      --border-light: #2D3241;\n      --border-medium: #3D4454;\n      --border-strong: #4D5568;\n      \n      --text-primary: #FFFFFF;\n      --text-secondary: #C4C9D4;\n      --text-tertiary: ${e};\n      --text-muted: #5A6274;\n      \n      /* Purple accent for secondary elements */\n      --secondary-accent: ${e};\n      --secondary-accent-light: ${e}26;\n      \n      --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.3);\n      --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.3), 0 1px 2px rgba(0, 0, 0, 0.4);\n      --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.4), 0 2px 4px rgba(0, 0, 0, 0.3);\n      --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.5), 0 4px 8px rgba(0, 0, 0, 0.3);\n      --shadow-xl: 0 16px 48px rgba(0, 0, 0, 0.6), 0 8px 16px rgba(0, 0, 0, 0.4);\n      \n      --accent-light: ${n}26;\n      --accent-soft: ${n}14;\n      \n      --message-user-bg: var(--accent);\n      --message-user-text: #1D2331;\n      --message-bot-bg: var(--secondary-accent);\n      --message-bot-text: #FFFFFF;\n\n      /* Animated background - subtle lime/purple glow */\n      --bg-pattern: radial-gradient(circle at 20% 50%, rgba(142, 255, 1, 0.06) 0%, transparent 50%),\n                     radial-gradient(circle at 80% 80%, rgba(125, 83, 255, 0.08) 0%, transparent 50%);\n    }\n\n    /* ===== RESET ===== */\n    *, *::before, *::after {\n      box-sizing: border-box;\n      margin: 0;\n      padding: 0;\n    }\n\n    /* ===== LAUNCHER BUTTON ===== */\n    .launcher {\n      position: fixed;\n      bottom: 24px;\n      bottom: calc(24px + env(safe-area-inset-bottom, 0px));\n      width: 64px;\n      height: 64px;\n      border-radius: var(--radius-full);\n      background: var(--accent);\n      border: none;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      transition: all var(--duration-base) var(--ease-out);\n      z-index: var(--z-launcher);\n      box-shadow: var(--shadow-lg);\n      overflow: visible;\n      -webkit-tap-highlight-color: transparent;\n      touch-action: manipulation;\n      -webkit-touch-callout: none;\n      user-select: none;\n      pointer-events: auto;\n      opacity: 0;\n    }\n\n    .launcher.ready {\n      opacity: 1;\n    }\n\n    /* Position: Right (default) */\n    .launcher.position-right {\n      right: 24px;\n      right: calc(24px + env(safe-area-inset-right, 0px));\n    }\n\n    /* Position: Left */\n    .launcher.position-left {\n      left: 24px;\n      left: calc(24px + env(safe-area-inset-left, 0px));\n    }\n\n    .launcher::before {\n      content: '';\n      position: absolute;\n      inset: 0;\n      border-radius: var(--radius-full);\n      background: radial-gradient(circle at center, rgba(255,255,255,0.3) 0%, transparent 70%);\n      opacity: 0;\n      transition: opacity var(--duration-base);\n    }\n\n    .launcher:hover::before {\n      opacity: 1;\n    }\n\n    .launcher:hover {\n      transform: scale(1.08) rotate(5deg);\n      background: var(--accent-hover);\n      box-shadow: var(--shadow-xl);\n    }\n\n    .launcher:active {\n      transform: scale(0.95);\n    }\n\n    .launcher:focus-visible {\n      outline: 2px solid var(--accent);\n      outline-offset: 4px;\n    }\n\n    .launcher svg {\n      width: 26px;\n      height: 26px;\n      fill: var(--accent-highlight);\n      transition: transform var(--duration-base) var(--ease-out),\n                  opacity var(--duration-fast);\n      position: relative;\n      z-index: 1;\n    }\n\n    .launcher .icon-chat {\n      position: absolute;\n    }\n\n    .launcher .icon-close {\n      position: absolute;\n      opacity: 0;\n      transform: rotate(-90deg) scale(0.8);\n    }\n\n    .launcher.open .icon-chat {\n      opacity: 0;\n      transform: rotate(90deg) scale(0.8);\n    }\n\n    .launcher.open .icon-close {\n      opacity: 1;\n      transform: rotate(0) scale(1);\n    }\n\n    /* Pulse animation for launcher */\n    @keyframes launcher-pulse {\n      0%, 100% {\n        box-shadow: var(--shadow-lg);\n      }\n      50% {\n        box-shadow: var(--shadow-xl);\n      }\n    }\n\n    .launcher.pulse {\n      animation: launcher-pulse 2s ease-in-out infinite;\n    }\n\n    /* Badge */\n    .launcher-badge {\n      top: -4px;\n      right: -4px;\n      min-width: 22px;\n      height: 22px;\n      padding: 0 6px;\n      border-radius: var(--radius-full);\n      background: var(--accent-primary);\n      color: #FFFFFF;\n      font-family: var(--font-family);\n      font-size: 12px;\n      font-weight: 800;\n      display: none;\n      align-items: center;\n      justify-content: center;\n      border: 2px solid var(--accent-primary);\n      box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n      z-index: 2;\n    }\n\n    .launcher-badge.visible {\n      display: flex;\n      animation: badge-bounce var(--duration-slow) var(--ease-bounce);\n    }\n\n    @keyframes badge-bounce {\n      0% { transform: scale(0); }\n      50% { transform: scale(1.3); }\n      70% { transform: scale(0.9); }\n      100% { transform: scale(1); }\n    }\n\n    /* ===== CHAT PANEL ===== */\n    .panel {\n      position: fixed;\n      bottom: calc(104px + env(safe-area-inset-bottom, 0px));\n      width: 400px;\n      height: 600px;\n      max-height: calc(100vh - 130px);\n      max-height: calc(100dvh - 130px);\n      background: var(--bg-primary);\n      border-radius: var(--radius-xl);\n      border: 1px solid var(--border-light);\n      box-shadow: var(--shadow-xl);\n      display: none;\n      flex-direction: column;\n      overflow: hidden;\n      z-index: var(--z-panel);\n      opacity: 0;\n      transform: translateY(16px) scale(0.94);\n      -webkit-overflow-scrolling: touch;\n      pointer-events: auto;\n      isolation: isolate;\n    }\n\n    /* Panel Position: Right (default) */\n    .panel.position-right {\n      right: calc(24px + env(safe-area-inset-right, 0px));\n      transform-origin: bottom right;\n    }\n\n    /* Panel Position: Left */\n    .panel.position-left {\n      left: calc(24px + env(safe-area-inset-left, 0px));\n      transform-origin: bottom left;\n    }\n\n    .panel::before {\n      content: '';\n      position: absolute;\n      inset: 0;\n      background: var(--bg-pattern);\n      pointer-events: none;\n      z-index: 0;\n    }\n\n    .panel.open {\n      display: flex;\n      animation: panel-enter var(--duration-slow) var(--ease-out) forwards;\n    }\n\n    .panel.closing {\n      animation: panel-exit var(--duration-base) var(--ease-in-out) forwards;\n    }\n\n    @keyframes panel-enter {\n      from {\n        opacity: 0;\n        transform: translateY(20px) scale(0.94);\n      }\n      to {\n        opacity: 1;\n        transform: translateY(0) scale(1);\n      }\n    }\n\n    @keyframes panel-exit {\n      from {\n        opacity: 1;\n        transform: translateY(0) scale(1);\n      }\n      to {\n        opacity: 0;\n        transform: translateY(20px) scale(0.94);\n      }\n    }\n\n    /* ===== HEADER ===== */\n    .header {\n      display: flex;\n      align-items: center;\n      gap: var(--space-3);\n      padding: var(--space-5);\n      background: var(--accent);\n      color: var(--accent-text);\n      border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n      flex-shrink: 0;\n      position: relative;\n      z-index: 1;\n    }\n\n    .header-avatar {\n      width: 40px;\n      height: 40px;\n      border-radius: var(--radius-full);\n      background: rgba(255, 255, 255, 0.2);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      flex-shrink: 0;\n      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);\n      position: relative;\n    }\n\n    .header-avatar::after {\n      content: '';\n      position: absolute;\n      bottom: 0;\n      right: 0;\n      width: 12px;\n      height: 12px;\n      border-radius: var(--radius-full);\n      background: #10B981;\n      border: 2.5px solid #FFFFFF;\n      box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.6), 0 2px 4px rgba(0, 0, 0, 0.2);\n      animation: pulse-badge 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;\n    }\n\n    @keyframes pulse-badge {\n      0%, 100% {\n        transform: scale(1);\n        box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.6), 0 2px 4px rgba(0, 0, 0, 0.2);\n      }\n      50% {\n        transform: scale(1.1);\n        box-shadow: 0 0 0 4px rgba(16, 185, 129, 0), 0 2px 6px rgba(0, 0, 0, 0.3);\n      }\n    }\n\n    .widget-offline .header-avatar {\n      background: rgba(239, 68, 68, 0.15);\n    }\n\n    .widget-offline .header-avatar::after {\n      background: #EF4444;\n      border-color: #FFFFFF;\n      box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.6), 0 2px 4px rgba(0, 0, 0, 0.2);\n      animation: pulse-badge-offline 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;\n    }\n\n    @keyframes pulse-badge-offline {\n      0%, 100% {\n        transform: scale(1);\n        box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.6), 0 2px 4px rgba(0, 0, 0, 0.2);\n      }\n      50% {\n        transform: scale(1.1);\n        box-shadow: 0 0 0 4px rgba(239, 68, 68, 0), 0 2px 6px rgba(0, 0, 0, 0.3);\n      }\n    }\n\n    .header-avatar svg {\n      width: 22px;\n      height: 22px;\n      fill: #FFFFFF;\n      transition: all 0.3s ease;\n    }\n\n    .widget-offline .avatar-icon-online {\n      fill: rgba(239, 68, 68, 0.6);\n      opacity: 0.7;\n      filter: grayscale(100%);\n    }\n\n    .widget-offline .avatar-icon-offline {\n      fill: rgba(239, 68, 68, 0.8);\n      opacity: 0.8;\n      filter: grayscale(20%);\n    }\n\n    .header-content {\n      flex: 1;\n      min-width: 0;\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      text-align: left;\n    }\n\n    .header-title {\n      font-family: var(--font-family);\n      font-size: var(--font-size-lg);\n      font-weight: var(--font-weight-semibold);\n      color: #FFFFFF;\n      line-height: 1.3;\n    }\n\n    .header-status {\n      display: flex;\n      align-items: center;\n      color: rgba(255, 255, 255, 0.9);\n      font-size: var(--font-size-sm);\n      margin-top: 4px;\n    }\n\n    .widget-offline .header {\n      background: linear-gradient(135deg, #1F2937 0%, #111827 100%);\n    }\n\n    .widget-offline .header-status {\n      display: flex;\n      align-items: center;\n      gap: var(--space-1);\n    }\n\n    .status-indicator {\n      display: flex;\n      align-items: center;\n      transition: all 0.3s ease;\n    }\n\n    .status-text {\n      font-family: var(--font-family);\n      font-size: 11px;\n      font-weight: 400;\n      color: rgba(255, 255, 255, 0.85);\n      letter-spacing: 0.3px;\n      text-transform: none;\n      line-height: 1;\n      animation: fade-in 0.4s ease-out;\n      transition: all 0.3s ease;\n    }\n\n    /* Remove any dot/indicator before status text */\n    .status-text::before,\n    .header-status::before,\n    .status-indicator::before {\n      display: none !important;\n      content: none !important;\n    }\n\n    @keyframes fade-in {\n      from {\n        opacity: 0;\n        transform: translateY(-2px);\n      }\n      to {\n        opacity: 1;\n        transform: translateY(0);\n      }\n    }\n\n    .status-text:hover {\n      color: rgba(255, 255, 255, 0.95);\n    }\n\n    .header-actions {\n      display: flex;\n      gap: var(--space-1);\n    }\n\n    .header-btn {\n      width: 36px;\n      height: 36px;\n      border-radius: var(--radius-md);\n      background: rgba(255, 255, 255, 0.1);\n      border: none;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      color: #FFFFFF;\n      opacity: 0.7;\n      transition: all var(--duration-fast);\n    }\n\n    .header-btn:hover {\n      background: rgba(255, 255, 255, 0.1);\n      opacity: 1;\n      color: var(--accent-highlight);\n      transform: scale(1.05);\n    }\n\n    .header-btn:active {\n      transform: scale(0.95);\n    }\n\n    .header-btn:focus-visible {\n      outline: 2px solid var(--accent);\n      outline-offset: -2px;\n    }\n\n    .header-btn svg {\n      width: 18px;\n      height: 18px;\n      fill: currentColor;\n    }\n\n    /* ===== MESSAGES ===== */\n    .messages {\n      flex: 1;\n      padding: var(--space-5);\n      overflow-y: auto;\n      background: var(--bg-secondary);\n      display: flex;\n      flex-direction: column;\n      gap: var(--space-4);\n      position: relative;\n      z-index: 1;\n    }\n\n    .messages::-webkit-scrollbar {\n      width: 6px;\n    }\n\n    .messages::-webkit-scrollbar-track {\n      background: transparent;\n    }\n\n    .messages::-webkit-scrollbar-thumb {\n      background: var(--border-medium);\n      border-radius: var(--radius-full);\n    }\n\n    .messages::-webkit-scrollbar-thumb:hover {\n      background: var(--border-strong);\n    }\n\n    /* Message Group */\n    .message-group {\n      display: flex;\n      flex-direction: column;\n      gap: var(--space-1);\n    }\n\n    .message-group.bot {\n      align-items: flex-start;\n    }\n\n    .message-group.user {\n      align-items: flex-end;\n    }\n\n    /* Message */\n    .message {\n      display: flex;\n      gap: var(--space-2);\n      max-width: 85%;\n      animation: message-slide-in var(--duration-base) var(--ease-out);\n    }\n\n    @keyframes message-slide-in {\n      from {\n        opacity: 0;\n        transform: translateY(10px) scale(0.98);\n      }\n      to {\n        opacity: 1;\n        transform: translateY(0) scale(1);\n      }\n    }\n\n    .message.bot {\n      align-self: flex-start;\n    }\n\n    .message.user {\n      align-self: flex-end;\n      flex-direction: row-reverse;\n    }\n\n    .message-avatar {\n      width: 32px;\n      height: 32px;\n      border-radius: var(--radius-full);\n      background: #1D2331;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      flex-shrink: 0;\n      box-shadow: var(--shadow-sm);\n    }\n\n    .message-avatar svg {\n      width: 18px;\n      height: 18px;\n      fill: var(--accent-highlight);\n    }\n\n    .message.user .message-avatar {\n      display: none;\n    }\n\n    .message-content {\n      display: flex;\n      flex-direction: column;\n      gap: var(--space-1);\n      flex: 1;\n    }\n\n    .message-bubble {\n      padding: var(--space-3) var(--space-4);\n      font-family: var(--font-family);\n      font-size: var(--font-size-base);\n      font-weight: var(--font-weight-normal);\n      line-height: var(--line-height);\n      word-wrap: break-word;\n      overflow-wrap: break-word;\n      position: relative;\n      transition: transform var(--duration-fast);\n    }\n\n    .message-bubble:hover {\n      transform: translateY(-1px);\n    }\n\n    .message.bot .message-bubble {\n      background: var(--message-bot-bg);\n      color: var(--message-bot-text);\n      border-radius: var(--radius-lg) var(--radius-lg) var(--radius-lg) var(--space-1);\n      box-shadow: var(--shadow-xs);\n    }\n\n    .message.user .message-bubble {\n      background: var(--accent-primary);\n      color: #FFFFFF;\n      border-radius: var(--radius-lg) var(--radius-lg) var(--space-1) var(--radius-lg);\n    }\n\n    /* Message Meta */\n    .message-meta {\n      display: flex;\n      align-items: center;\n      gap: var(--space-2);\n      padding: 0 var(--space-1);\n      font-family: var(--font-family);\n      font-size: var(--font-size-xs);\n      color: var(--text-muted);\n    }\n\n    .message.user .message-meta {\n      flex-direction: row-reverse;\n    }\n\n    .message-time {\n      opacity: 0;\n      transition: opacity var(--duration-fast);\n    }\n\n    .message:hover .message-time {\n      opacity: 1;\n    }\n\n    .message-status {\n      display: flex;\n      align-items: center;\n      gap: 2px;\n    }\n\n    .message-status svg {\n      width: 14px;\n      height: 14px;\n      fill: currentColor;\n    }\n\n    /* Message Reactions */\n    .message-reactions {\n      display: flex;\n      gap: var(--space-1);\n      flex-wrap: wrap;\n      margin-top: var(--space-1);\n    }\n\n    .reaction {\n      display: flex;\n      align-items: center;\n      gap: 4px;\n      padding: 2px 8px;\n      border-radius: var(--radius-full);\n      background: var(--bg-tertiary);\n      border: 1px solid var(--border-light);\n      font-size: var(--font-size-sm);\n      cursor: pointer;\n      transition: all var(--duration-fast);\n    }\n\n    .reaction:hover {\n      background: var(--bg-hover);\n      transform: scale(1.05);\n    }\n\n    .reaction.active {\n      background: var(--accent-light);\n      border-color: var(--accent);\n    }\n\n    .reaction-emoji {\n      font-size: 14px;\n    }\n\n    .reaction-count {\n      font-family: var(--font-mono);\n      font-size: var(--font-size-xs);\n      color: var(--text-secondary);\n      font-weight: var(--font-weight-medium);\n    }\n\n    /* Attachment */\n    .message-attachment {\n      margin-top: var(--space-2);\n      border-radius: var(--radius-md);\n      overflow: hidden;\n      border: 1px solid var(--border-light);\n      background: var(--bg-primary);\n    }\n\n    .attachment-image {\n      width: 100%;\n      display: block;\n      max-height: 200px;\n      object-fit: cover;\n    }\n\n    .attachment-file {\n      display: flex;\n      align-items: center;\n      gap: var(--space-3);\n      padding: var(--space-3);\n    }\n\n    .attachment-icon {\n      width: 40px;\n      height: 40px;\n      border-radius: var(--radius-md);\n      background: var(--accent-soft);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      flex-shrink: 0;\n    }\n\n    .attachment-icon svg {\n      width: 20px;\n      height: 20px;\n      fill: var(--accent);\n    }\n\n    .attachment-info {\n      flex: 1;\n      min-width: 0;\n    }\n\n    .attachment-name {\n      font-family: var(--font-family);\n      font-size: var(--font-size-sm);\n      font-weight: var(--font-weight-medium);\n      color: var(--text-primary);\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n\n    .attachment-size {\n      font-family: var(--font-mono);\n      font-size: var(--font-size-xs);\n      color: var(--text-tertiary);\n    }\n\n    /* Welcome */\n    .welcome {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      justify-content: center;\n      text-align: center;\n      padding: var(--space-8) var(--space-6);\n      flex: 1;\n      background: var(--bg-primary);\n      pointer-events: auto;\n      position: relative;\n      z-index: 2;\n    }\n\n    .welcome-card {\n      background: var(--bg-primary);\n      padding: var(--space-8) var(--space-6);\n      border-radius: var(--radius-xl);\n      border: 1px solid var(--border-light);\n      box-shadow: var(--shadow-md);\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      gap: var(--space-4);\n      max-width: 320px;\n      pointer-events: auto;\n      position: relative;\n      z-index: 3;\n    }\n\n    .welcome-icon {\n      width: 48px;\n      height: 48px;\n      border-radius: var(--radius-lg);\n      background: #1D2331;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      box-shadow: var(--shadow-sm);\n    }\n\n    .welcome-icon svg {\n      width: 24px;\n      height: 24px;\n      fill: var(--accent-highlight);\n    }\n\n    .welcome-title {\n      font-family: var(--font-family);\n      font-size: 18px;\n      font-weight: var(--font-weight-bold);\n      color: var(--text-primary);\n      margin: 0;\n    }\n\n    .welcome-text {\n      font-family: var(--font-family);\n      font-size: 14px;\n      color: var(--text-secondary);\n      line-height: 1.5;\n      margin: 0;\n    }\n\n    .welcome-name-form {\n      width: 100%;\n      margin-top: var(--space-3);\n      pointer-events: auto;\n      position: relative;\n      z-index: 5;\n    }\n\n    .welcome-name-label {\n      display: block;\n      font-size: 13px;\n      font-weight: var(--font-weight-medium);\n      color: var(--text-secondary);\n      margin-bottom: var(--space-2);\n    }\n\n    .welcome-name-input {\n      width: 100%;\n      padding: var(--space-3);\n      border: 1px solid var(--border-medium);\n      border-radius: var(--radius-md);\n      font-family: var(--font-family);\n      font-size: 14px;\n      color: var(--text-primary);\n      background: var(--bg-primary);\n      outline: none;\n      transition: border-color var(--duration-fast), box-shadow var(--duration-fast);\n      pointer-events: auto;\n      position: relative;\n      z-index: 6;\n    }\n\n    .welcome-name-input:focus {\n      border-color: var(--accent-primary);\n      box-shadow: 0 0 0 3px hsla(var(--accent-h), 70%, 60%, 0.15);\n    }\n\n    .welcome-name-input::placeholder {\n      color: var(--text-tertiary);\n    }\n\n    .welcome-action {\n      margin-top: var(--space-3);\n      width: 100%;\n      pointer-events: auto;\n      position: relative;\n      z-index: 10;\n    }\n\n    .btn-start {\n      width: 100%;\n      padding: var(--space-3) var(--space-4);\n      border-radius: var(--radius-lg);\n      background: var(--accent-primary);\n      color: #FFFFFF;\n      border: none;\n      font-family: var(--font-family);\n      font-size: 14px;\n      font-weight: var(--font-weight-semibold);\n      cursor: pointer;\n      transition: all var(--duration-fast);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      gap: var(--space-2);\n      pointer-events: auto;\n      position: relative;\n      z-index: 11;\n    }\n\n    .btn-start:hover {\n      background: var(--accent-hover);\n      transform: translateY(-1px);\n      box-shadow: var(--shadow-md);\n    }\n\n    .btn-start:active {\n      transform: translateY(0);\n    }\n\n    /* Quick Replies */\n    .quick-replies {\n      display: flex;\n      flex-wrap: wrap;\n      gap: var(--space-2);\n      margin-top: var(--space-3);\n      animation: fade-in var(--duration-base) var(--ease-out);\n    }\n\n    @keyframes fade-in {\n      from { opacity: 0; transform: translateY(4px); }\n      to { opacity: 1; transform: translateY(0); }\n    }\n\n    .quick-reply {\n      padding: var(--space-2) var(--space-4);\n      border-radius: var(--radius-full);\n      background: var(--bg-primary);\n      border: 1px solid var(--border-medium);\n      font-family: var(--font-family);\n      font-size: var(--font-size-sm);\n      font-weight: var(--font-weight-medium);\n      color: var(--text-secondary);\n      cursor: pointer;\n      transition: all var(--duration-fast);\n    }\n\n    .quick-reply:hover {\n      background: var(--accent-highlight);\n      color: #1D2331;\n      border-color: var(--accent-highlight);\n      transform: translateY(-2px);\n      box-shadow: var(--shadow-md);\n    }\n\n    .quick-reply:active {\n      transform: translateY(0);\n    }\n\n    /* Typing */\n    .typing {\n      display: flex;\n      gap: var(--space-2);\n      align-self: flex-start;\n      animation: message-slide-in var(--duration-base) var(--ease-out);\n    }\n\n    .typing-avatar {\n      width: 32px;\n      height: 32px;\n      border-radius: var(--radius-full);\n      background: #1D2331;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      flex-shrink: 0;\n      box-shadow: var(--shadow-sm);\n    }\n\n    .typing-avatar svg {\n      width: 18px;\n      height: 18px;\n      fill: var(--accent-highlight);\n    }\n\n    .typing-content {\n      display: flex;\n      flex-direction: column;\n      gap: var(--space-1);\n    }\n\n    .typing-name {\n      font-family: var(--font-family);\n      font-size: var(--font-size-xs);\n      font-weight: var(--font-weight-medium);\n      color: var(--text-tertiary);\n      padding: 0 var(--space-1);\n    }\n\n    .typing-bubble {\n      background: var(--message-bot-bg);\n      padding: var(--space-3) var(--space-4);\n      border-radius: var(--radius-lg) var(--radius-lg) var(--radius-lg) var(--space-1);\n      display: flex;\n      gap: 5px;\n      align-items: center;\n      box-shadow: var(--shadow-xs);\n    }\n\n    .typing-dot {\n      width: 7px;\n      height: 7px;\n      border-radius: var(--radius-full);\n      background: var(--text-muted);\n      animation: typing-bounce 1.4s ease-in-out infinite;\n    }\n\n    .typing-dot:nth-child(2) { animation-delay: 0.15s; }\n    .typing-dot:nth-child(3) { animation-delay: 0.3s; }\n\n    @keyframes typing-bounce {\n      0%, 60%, 100% {\n        transform: translateY(0);\n        opacity: 0.5;\n      }\n      30% {\n        transform: translateY(-6px);\n        opacity: 1;\n      }\n    }\n\n    /* ===== COMPOSER ===== */\n    .composer {\n      display: flex;\n      flex-direction: column;\n      gap: var(--space-2);\n      padding: var(--space-4);\n      background: var(--bg-primary);\n      border-top: 1px solid var(--border-light);\n      flex-shrink: 0;\n      position: relative;\n      z-index: 1;\n    }\n\n    .composer-main {\n      display: flex;\n      align-items: flex-end;\n      gap: var(--space-2);\n    }\n\n    .composer-actions {\n      display: flex;\n      gap: var(--space-1);\n    }\n\n    .composer-action-btn {\n      width: 36px;\n      height: 36px;\n      border-radius: var(--radius-md);\n      background: transparent;\n      border: none;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      color: var(--text-tertiary);\n      transition: all var(--duration-fast);\n    }\n\n    .composer-action-btn:hover {\n      background: var(--bg-hover);\n      color: var(--accent);\n      transform: scale(1.08);\n    }\n\n    .composer-action-btn:active {\n      transform: scale(0.95);\n    }\n\n    .composer-action-btn svg {\n      width: 20px;\n      height: 20px;\n      fill: currentColor;\n    }\n\n    .composer-input-wrapper {\n      flex: 1;\n      position: relative;\n    }\n\n    .composer-input {\n      width: 100%;\n      min-height: 44px;\n      max-height: 120px;\n      padding: var(--space-3) var(--space-4);\n      border: 1px solid var(--border-medium);\n      border-radius: var(--radius-lg);\n      font-family: var(--font-family);\n      font-size: var(--font-size-base);\n      font-weight: var(--font-weight-normal);\n      line-height: var(--line-height);\n      color: var(--text-primary);\n      background: var(--bg-primary);\n      outline: none;\n      resize: none;\n      transition: all var(--duration-fast);\n    }\n\n    .composer-input::placeholder {\n      color: var(--text-muted);\n    }\n\n    .composer-input:focus {\n      border-color: var(--accent-primary);\n    }\n\n    .composer-send {\n      width: 44px;\n      height: 44px;\n      border-radius: var(--radius-lg);\n      background: var(--accent);\n      border: none;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      flex-shrink: 0;\n      transition: all var(--duration-fast);\n      position: relative;\n      overflow: hidden;\n    }\n\n    .composer-send::before {\n      content: '';\n      position: absolute;\n      inset: 0;\n      background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, transparent 100%);\n      opacity: 0;\n      transition: opacity var(--duration-fast);\n    }\n\n    .composer-send:hover:not(:disabled)::before {\n      opacity: 1;\n    }\n\n    .composer-send:hover:not(:disabled) {\n      background: var(--accent-hover);\n      transform: scale(1.05) rotate(-5deg);\n      box-shadow: var(--shadow-md);\n    }\n\n    .composer-send:active:not(:disabled) {\n      transform: scale(0.95);\n    }\n\n    .composer-send:focus-visible {\n      outline: 2px solid var(--accent);\n      outline-offset: 3px;\n    }\n\n    .composer-send:disabled {\n      opacity: 0.4;\n      cursor: not-allowed;\n    }\n\n    .composer-send svg {\n      width: 20px;\n      height: 20px;\n      fill: #1D2331;\n      position: relative;\n      z-index: 1;\n    }\n\n    /* File Upload Preview */\n    .upload-preview {\n      display: none;\n      padding: var(--space-3);\n      background: var(--bg-tertiary);\n      border-radius: var(--radius-md);\n      gap: var(--space-3);\n    }\n\n    .upload-preview.visible {\n      display: flex;\n    }\n\n    .upload-preview-thumb {\n      width: 50px;\n      height: 50px;\n      border-radius: var(--radius-sm);\n      background: var(--bg-hover);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      flex-shrink: 0;\n    }\n\n    .upload-preview-thumb img {\n      width: 100%;\n      height: 100%;\n      object-fit: cover;\n      border-radius: var(--radius-sm);\n    }\n\n    .upload-preview-thumb svg {\n      width: 24px;\n      height: 24px;\n      fill: var(--text-muted);\n    }\n\n    .upload-preview-info {\n      flex: 1;\n      min-width: 0;\n    }\n\n    .upload-preview-name {\n      font-family: var(--font-family);\n      font-size: var(--font-size-sm);\n      font-weight: var(--font-weight-medium);\n      color: var(--text-primary);\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n\n    .upload-preview-size {\n      font-family: var(--font-mono);\n      font-size: var(--font-size-xs);\n      color: var(--text-tertiary);\n    }\n\n    .upload-preview-remove {\n      width: 28px;\n      height: 28px;\n      border-radius: var(--radius-sm);\n      background: transparent;\n      border: none;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      color: var(--text-tertiary);\n      transition: all var(--duration-fast);\n    }\n\n    .upload-preview-remove:hover {\n      background: var(--bg-hover);\n      color: #EF4444;\n    }\n\n    .upload-preview-remove svg {\n      width: 16px;\n      height: 16px;\n      fill: currentColor;\n    }\n\n    /* Emoji Picker */\n    .emoji-picker {\n      position: absolute;\n      bottom: 100%;\n      left: 0;\n      margin-bottom: var(--space-2);\n      width: 300px;\n      background: var(--bg-primary);\n      border: 1px solid var(--border-light);\n      border-radius: var(--radius-lg);\n      box-shadow: var(--shadow-xl);\n      display: none;\n      flex-direction: column;\n      overflow: hidden;\n      z-index: 100;\n    }\n\n    .emoji-picker.visible {\n      display: flex;\n      animation: picker-enter var(--duration-base) var(--ease-out);\n    }\n\n    @keyframes picker-enter {\n      from {\n        opacity: 0;\n        transform: translateY(8px) scale(0.96);\n      }\n      to {\n        opacity: 1;\n        transform: translateY(0) scale(1);\n      }\n    }\n\n    .emoji-picker-header {\n      padding: var(--space-3);\n      border-bottom: 1px solid var(--border-light);\n    }\n\n    .emoji-picker-search {\n      width: 100%;\n      padding: var(--space-2) var(--space-3);\n      border: 1px solid var(--border-medium);\n      border-radius: var(--radius-md);\n      font-family: var(--font-family);\n      font-size: var(--font-size-sm);\n      background: var(--bg-secondary);\n      color: var(--text-primary);\n      outline: none;\n    }\n\n    .emoji-picker-search:focus {\n      border-color: var(--accent);\n    }\n\n    .emoji-picker-content {\n      padding: var(--space-3);\n      max-height: 200px;\n      overflow-y: auto;\n    }\n\n    .emoji-grid {\n      display: grid;\n      grid-template-columns: repeat(8, 1fr);\n      gap: var(--space-1);\n    }\n\n    .emoji-btn {\n      width: 32px;\n      height: 32px;\n      border: none;\n      background: transparent;\n      font-size: 20px;\n      cursor: pointer;\n      border-radius: var(--radius-sm);\n      transition: all var(--duration-fast);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    }\n\n    .emoji-btn:hover {\n      background: var(--bg-hover);\n      transform: scale(1.2);\n    }\n\n    /* Hidden Inputs */\n    #file-input {\n      display: none;\n    }\n\n    /* Drag & Drop Overlay */\n    .drop-overlay {\n      position: absolute;\n      inset: 0;\n      background: var(--bg-overlay);\n      backdrop-filter: blur(8px);\n      display: none;\n      align-items: center;\n      justify-content: center;\n      z-index: 10;\n      border-radius: var(--radius-xl);\n    }\n\n    .drop-overlay.visible {\n      display: flex;\n      animation: fade-in var(--duration-base);\n    }\n\n    .drop-content {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      gap: var(--space-4);\n      padding: var(--space-8);\n      background: var(--bg-primary);\n      border-radius: var(--radius-xl);\n      border: 2px dashed var(--accent);\n    }\n\n    .drop-icon {\n      width: 64px;\n      height: 64px;\n      border-radius: var(--radius-xl);\n      background: var(--accent-soft);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      animation: drop-bounce 0.6s ease-in-out infinite;\n    }\n\n    @keyframes drop-bounce {\n      0%, 100% { transform: translateY(0); }\n      50% { transform: translateY(-8px); }\n    }\n\n    .drop-icon svg {\n      width: 32px;\n      height: 32px;\n      fill: var(--accent);\n    }\n\n    .drop-text {\n      font-family: var(--font-family);\n      font-size: var(--font-size-lg);\n      font-weight: var(--font-weight-semibold);\n      color: var(--text-primary);\n    }\n\n    /* ===== CONTACT FORM ===== */\n    .composer-container {\n      display: flex;\n      flex-direction: column;\n      width: 100%;\n      flex-shrink: 0;\n    }\n\n    .contact-form-container {\n      display: flex;\n      flex-direction: column;\n      flex: 1;\n      overflow-y: auto;\n    }\n\n    .contact-form {\n      padding: var(--space-6);\n      flex: 1;\n      display: flex;\n      flex-direction: column;\n    }\n\n    .contact-form-header {\n      margin-bottom: var(--space-6);\n      text-align: center;\n    }\n\n    .contact-form-title {\n      font-size: var(--font-size-lg);\n      font-weight: var(--font-weight-semibold);\n      color: var(--text-primary);\n      margin: 0 0 var(--space-2) 0;\n    }\n\n    .contact-form-desc {\n      font-size: var(--font-size-sm);\n      color: var(--text-secondary);\n      margin: 0;\n      line-height: 1.5;\n    }\n\n    .contact-form-fields {\n      display: flex;\n      flex-direction: column;\n      gap: var(--space-4);\n    }\n\n    .contact-form-field {\n      display: flex;\n      flex-direction: column;\n    }\n\n    .contact-input,\n    .contact-textarea {\n      width: 100%;\n      padding: var(--space-3) var(--space-4);\n      border: 1px solid var(--border-medium);\n      border-radius: var(--radius-lg);\n      font-family: var(--font-family);\n      font-size: var(--font-size-base);\n      color: var(--text-primary);\n      background: var(--bg-primary);\n      outline: none;\n      transition: all var(--duration-fast);\n    }\n\n    .contact-input::placeholder,\n    .contact-textarea::placeholder {\n      color: var(--text-muted);\n    }\n\n    .contact-input:focus,\n    .contact-textarea:focus {\n      border-color: var(--accent-primary);\n      box-shadow: 0 0 0 3px hsla(var(--accent-h), 70%, 60%, 0.15);\n    }\n\n    .contact-textarea {\n      resize: vertical;\n      min-height: 80px;\n    }\n\n    .contact-submit {\n      width: 100%;\n      padding: var(--space-3) var(--space-4);\n      background: var(--accent);\n      color: white;\n      border: none;\n      border-radius: var(--radius-lg);\n      font-family: var(--font-family);\n      font-size: var(--font-size-base);\n      font-weight: var(--font-weight-semibold);\n      cursor: pointer;\n      transition: all var(--duration-fast);\n      margin-top: var(--space-2);\n    }\n\n    .contact-submit:hover {\n      background: var(--accent-hover);\n      transform: translateY(-1px);\n      box-shadow: 0 4px 12px hsla(var(--accent-h), 70%, 60%, 0.2);\n    }\n\n    .contact-submit:active {\n      transform: translateY(0);\n    }\n\n    .contact-submit:disabled {\n      opacity: 0.5;\n      cursor: not-allowed;\n      transform: none;\n    }\n\n    .contact-success {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      justify-content: center;\n      text-align: center;\n      padding: var(--space-6);\n      color: var(--text-primary);\n    }\n\n    .contact-success p {\n      font-size: var(--font-size-base);\n      margin: 0;\n      line-height: 1.5;\n    }\n\n    /* ===== POWERED BY ===== */\n    .powered {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      gap: var(--space-1);\n      padding: var(--space-2) var(--space-3);\n      background: var(--bg-primary);\n      border-top: 1px solid var(--border-light);\n      font-family: var(--font-family);\n      font-size: 10px;\n      color: var(--text-tertiary);\n      position: relative;\n      z-index: 10;\n      white-space: nowrap;\n      opacity: 0.8;\n      width: 100%;\n      flex-shrink: 0;\n    }\n\n    .powered a {\n      color: var(--text-primary);\n      text-decoration: none;\n      font-weight: var(--font-weight-semibold);\n      transition: color var(--duration-fast);\n    }\n\n    .powered a:hover {\n      color: var(--accent-hover);\n    }\n\n    /* ===== RESPONSIVE ===== */\n    @media (max-width: 480px) {\n      .launcher {\n        bottom: calc(var(--space-4) + env(safe-area-inset-bottom, 0px));\n        ${"left"===t?"left":"right"}: calc(var(--space-4) + env(safe-area-inset-right, 0px));\n        width: 56px;\n        height: 56px;\n      }\n\n      .launcher svg {\n        width: 24px;\n        height: 24px;\n      }\n\n      .launcher.open {\n        display: none;\n      }\n\n      .panel {\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        width: 100%;\n        height: 100%;\n        max-height: 100%;\n        max-height: 100dvh;\n\nborder-radius: 0;\n        border: none;\n        transform: translateY(0) scale(1);\n      }\n      \n      .panel.open {\n        animation: panel-enter-mobile var(--duration-slow) var(--ease-out) forwards;\n      }\n      \n      .panel.closing {\n        animation: panel-exit-mobile var(--duration-base) var(--ease-in-out) forwards;\n      }\n\n      .emoji-picker {\n        width: calc(100% - var(--space-8));\n        left: var(--space-4);\n      }\n      \n      .composer {\n        padding-bottom: calc(var(--space-4) + env(safe-area-inset-bottom, 0px));\n      }\n      \n      .powered {\n        padding-bottom: calc(var(--space-3) + env(safe-area-inset-bottom, 0px));\n      }\n      \n      .messages {\n        -webkit-overflow-scrolling: touch;\n      }\n      \n      .composer-input {\n        font-size: 16px; /* Prevents iOS zoom on focus */\n      }\n    }\n    \n    @keyframes panel-enter-mobile {\n      from {\n        opacity: 0;\n        transform: translateY(100%);\n      }\n      to {\n        opacity: 1;\n        transform: translateY(0);\n      }\n    }\n    \n    @keyframes panel-exit-mobile {\n      from {\n        opacity: 1;\n        transform: translateY(0);\n      }\n      to {\n        opacity: 0;\n        transform: translateY(100%);\n      }\n    }\n\n    /* Hidden file input */\n    input[type="file"] {\n      display: none;\n    }\n    `}(t,s,n,r.position),m,0,E,p,r.position);$.innerHTML=l,function(n,e){const a=n.getElementById("launcher");a&&(a.addEventListener("click",()=>{e(),f()}),setTimeout(()=>a.classList.add("ready"),100))}($,()=>D()),function(n,e){const a=n.getElementById("close-btn");a&&a.addEventListener("click",()=>{e(),h()})}($,()=>D());const{saveDraft:v,loadDraft:u,clearDraft:b}=function(n,e){const a=n.getElementById("input"),t=n.getElementById("send-btn"),i=`chatiq_draft_${e}`;if(!a)return{saveDraft:()=>{},loadDraft:()=>{},clearDraft:()=>{}};function r(){localStorage.setItem(i,a.value)}return a.addEventListener("input",r),{saveDraft:r,loadDraft:function(){const n=localStorage.getItem(i);n&&(a.value=n,a.style.height="auto",a.style.height=Math.min(a.scrollHeight,120)+"px",t&&(t.disabled=!n.trim()),a.dispatchEvent(new Event("input")))},clearDraft:function(){localStorage.removeItem(i)}}}($,e);let y=null;!function(n,e){const a=n.getElementById("attach-btn"),t=n.getElementById("file-input"),i=n.getElementById("upload-remove"),r=n.getElementById("upload-preview"),o=n.getElementById("upload-name"),s=n.getElementById("upload-size"),c=n.getElementById("upload-thumb"),l=n.getElementById("drop-overlay"),p=n.getElementById("panel");if(!(a&&t&&i&&r&&o&&s&&c&&l&&p))return;const m=n=>{if(n.size>10485760)alert("File size must be less than 10MB");else{if(e(n),o.textContent=n.name,s.textContent=d(n.size),n.type.startsWith("image/")){const e=new FileReader;e.onload=e=>{e.target?.result&&(c.innerHTML=`<img src="${e.target.result}" alt="${n.name}">`)},e.readAsDataURL(n)}else c.innerHTML='\n        <svg viewBox="0 0 24 24">\n            <path d="M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6H6zm7 7V3.5L18.5 9H13z"/>\n        </svg>\n      ';r.classList.add("visible")}};a.addEventListener("click",()=>t.click()),t.addEventListener("change",n=>{const e=n.target.files;e&&e[0]&&m(e[0])}),i.addEventListener("click",()=>{e(null),t.value="",r.classList.remove("visible")});let g=0;p.addEventListener("dragenter",n=>{n.preventDefault(),n.stopPropagation(),g++,l.classList.add("visible")}),p.addEventListener("dragleave",n=>{n.preventDefault(),n.stopPropagation(),g--,0===g&&l.classList.remove("visible")}),p.addEventListener("dragover",n=>{n.preventDefault(),n.stopPropagation()}),p.addEventListener("drop",n=>{n.preventDefault(),n.stopPropagation(),g=0,l.classList.remove("visible"),n.dataTransfer?.files&&n.dataTransfer.files[0]&&m(n.dataTransfer.files[0])})}($,n=>{y=n,w?.setSendDisabled(!n&&!$?.getElementById("input")?.value.trim())});const w=function(n,e){const a=n.getElementById("input"),t=n.getElementById("send-btn");if(!a||!t)return;const i=()=>{const n=a.value.trim();e(n||"")};return a.addEventListener("input",()=>{t.disabled=0===a.value.trim().length,a.style.height="auto";const n=Math.min(a.scrollHeight,120);a.style.height=n+"px"}),a.addEventListener("keydown",n=>{"Enter"!==n.key||n.shiftKey||(n.preventDefault(),i())}),t.addEventListener("click",i),{setLoading:n=>{n?(t.innerHTML="‚è≥",t.disabled=!0):(t.innerHTML="‚û§",t.disabled=0===a.value.trim().length)},setSendDisabled:n=>{t.disabled=n},clear:()=>{a.value="",a.style.height="auto",t.disabled=!0}}}($,async n=>{if(!n&&!y)return;let e=null;if(y&&a){w?.setLoading(!0);const n=await async function(n,e){const a=new FormData;a.append("file",e),a.append("siteId",n);try{const n=await fetch(`${i}/upload`,{method:"POST",body:a});if(n.ok)return await n.json()}catch(t){console.warn("[Chtq] Upload failed:",t)}return null}(a,y);if(!n)return void w?.setLoading(!1);e=n}if(H(n,"user",e),g(),a){const t=localStorage.getItem("chatiq_visitor_name")||"Guest";!function(n,e,a,t,i){x?.connected?x.emit("visitor:message",{siteId:n,visitorId:e,text:a,visitorName:t,attachment:i}):console.warn("[Chtq] Socket not connected, cannot send message")}(a,B,n,t,e?JSON.stringify(e):void 0)}y&&(!function(n){const e=n.getElementById("file-input"),a=n.getElementById("upload-preview");e&&(e.value=""),a&&a.classList.remove("visible")}($),y=null),w?.clear(),b(),w?.setLoading(!1)});(function(n){const e=n.getElementById("emoji-btn"),a=n.getElementById("emoji-picker"),t=n.getElementById("emoji-grid"),i=n.getElementById("emoji-search"),r=n.getElementById("input"),o=n.getElementById("send-btn");e&&a&&t&&i&&r&&(e.addEventListener("click",n=>{n.stopPropagation(),a.classList.toggle("visible"),a.classList.contains("visible")&&(F(t,""),i.focus())}),n.addEventListener("click",n=>{const t=n.target;a.contains(t)||e.contains(t)||a.classList.remove("visible")}),i.addEventListener("input",n=>{const e=n.target;F(t,e.value.toLowerCase())}),t.addEventListener("click",n=>{const e=n.target.closest(".emoji-btn");if(e&&e.dataset.emoji){const n=e.dataset.emoji;!function(n,e){const a=n.selectionStart,t=n.selectionEnd,i=n.value;n.value=i.substring(0,a)+e+i.substring(t),n.selectionStart=n.selectionEnd=a+e.length}(r,n),o.disabled=0===r.value.trim().length,r.style.height="auto",r.style.height=Math.min(r.scrollHeight,120)+"px",a.classList.remove("visible"),r.focus()}}))})($),u()}(),function(n,e,a){if(window.io)y(n,e,a);else{const t=document.createElement("script");t.src="https://cdn.socket.io/4.7.2/socket.io.min.js",t.onload=()=>y(n,e,a),document.head.appendChild(t)}}(a,B,{onAdminMessage:n=>{!function(){if(!$)return;!function(n,e,a){const t=n.getElementById("messages");if(!t)return;if(n.getElementById("typing"))return;const i=document.createElement("div");i.className="typing",i.id="typing";const r=a?`<img src="${a}" alt="${e}" class="typing-avatar-img" style="width:100%;height:100%;object-fit:cover;border-radius:50%;" />`:'<svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>';i.innerHTML=`\n    <div class="typing-avatar" style="width:32px;height:32px;border-radius:50%;background:#1D2331;display:flex;align-items:center;justify-content:center;margin-right:8px;">\n      ${r}\n    </div>\n    <div class="typing-content">\n      <div class="typing-name">${l(e)}</div>\n      <div class="typing-bubble">\n        <span class="typing-dot"></span>\n        <span class="typing-dot"></span>\n        <span class="typing-dot"></span>\n      </div>\n    </div>\n  `,i.style.display="flex",i.style.alignItems="flex-end",i.style.marginBottom="16px",i.style.animation="fade-in 0.3s ease-out",t.appendChild(i),z(t)}($,m,C)}(),setTimeout(()=>{H(n.text,"bot",n.attachment,n.messageId),L&&v(),function(){if(!$)return;!function(n){const e=n.getElementById("typing");e&&e.remove()}($)}()},800)},onMessageEdited:n=>{if(!$)return;const e=$.querySelector(`[data-message-id="${n.messageId}"]`);if(e){const a=e.querySelector(".message-bubble");if(a){const e=a.querySelector(".message-attachment"),t=e?e.outerHTML:"";a.innerHTML=l(n.text)+t}}},onMessageDeleted:n=>{if(!$)return;const e=$.querySelector(`[data-message-id="${n.messageId}"]`);if(e){const n=e;n.style.transition="opacity 0.3s, transform 0.3s",n.style.opacity="0",n.style.transform="scale(0.95)",setTimeout(()=>n.remove(),300)}}}),await async function(){if(!a)return;const n=await async function(n,e){try{const a=await fetch(`${i}/chat/visitor-history/${n}/${e}`);if(a.ok)return await a.json()}catch(a){console.warn("[Chtq] Failed to fetch visitor history:",a)}return{data:[]}}(a,B);if(!$)return;for(const e of n.data)k($,{text:e.text,from:"visitor"===e.from?"user":"bot",attachment:e.attachment,messageId:e.id,agentAvatar:C})}(),setInterval(async()=>{a&&(M=await b(a),function(){if(!$)return;const n=$.querySelector(".status-text");n&&(n.textContent=M.isOpen?c("online"):c("offline"))}())},6e4)}function D(){if(L=!L,$&&(function(n,e){const a=n.getElementById("launcher");a&&(e?(a.classList.add("open"),a.setAttribute("aria-expanded","true"),a.setAttribute("aria-label","Close chat")):(a.classList.remove("open"),a.setAttribute("aria-expanded","false"),a.setAttribute("aria-label","Open chat")))}($,L),function(n,e){const a=n.getElementById("panel");if(a)if(e){a.style.display="flex",a.offsetWidth,a.classList.add("open"),a.classList.remove("closing");const e=n.getElementById("input");e&&window.innerWidth>768&&setTimeout(()=>e.focus(),300)}else a.classList.remove("open"),a.classList.add("closing"),a.addEventListener("animationend",()=>{a.classList.contains("closing")&&(a.style.display="none",a.classList.remove("closing"))},{once:!0})}($,L),L)){I=0,w($,0);const n=$.getElementById("messages");n&&z(n)}}function H(n,e,a=null,t){$&&(k($,{text:n,from:e,attachment:a,messageId:t,agentAvatar:C}),"bot"!==e||L||(I++,w($,I),u()))}console.log(`[Chtq] Widget v${n} initialized`),console.log(`[Chtq] Organization ID: ${e}`),console.log(`[Chtq] Visitor ID: ${B}`),globalThis.ChatIQ={version:n,siteId:a,visitorId:B,open:()=>{!L&&$&&D()},close:()=>{L&&$&&D()},toggle:D,sendMessage:(n,e)=>H(n,"user",e),showQuickReplies:n=>{$&&function(n,e,a){const t=n.getElementById("messages");if(!t)return;const i=document.createElement("div");i.className="quick-replies",i.innerHTML=e.map(n=>`<button class="quick-reply" data-text="${l(n)}">${l(n)}</button>`).join(""),t.appendChild(i),z(t),i.addEventListener("click",n=>{const e=n.target.closest(".quick-reply");e&&e.dataset.text&&(a(e.dataset.text),i.remove())})}($,n,n=>{if($){const e=$.getElementById("input");if(e){e.value=n,e.dispatchEvent(new Event("input"));const a=$.getElementById("send-btn");a&&a.click()}}})}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{S()}):S()}()}();
